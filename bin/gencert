#!/bin/sh
#
# Generates key/cert for specified host.
#
[ "$#" -eq 1 ] || {
  echo "Usage: $0 host" >&2
  exit 1
}
HOST="$1"
echo "Generating key/cert for $HOST in /certs.."
mkdir -p /certs/

cfssl gencert \
  -hostname $HOST \
  -ca /certs/ca.pem \
  -ca-key /certs/ca-key.pem \
  -config /etc/configs/ca-config.json \
   /etc/configs/req-csr.json | cfssljson -bare /certs/$HOST
rm /certs/*.csr
